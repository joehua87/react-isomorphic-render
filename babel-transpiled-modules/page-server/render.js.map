{"version":3,"sources":["../../source/page-server/render.js"],"names":[],"mappings":"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","file":"render.js","sourcesContent":["// produces wrong line numbers:\n// import 'source-map-support/register'\n\nimport React from 'react'\n\nimport fs from 'fs'\n\nimport Html from './html'\n\nimport { server as render } from '../redux/render'\n\n// isomorphic (universal) rendering (middleware).\n// will be used in web_application.use(...)\nexport default function({ development, localize, preferred_locale, assets, request, respond, fail, redirect, disable_server_side_rendering, log, create_store, create_routes, markup_wrapper, head, body, style, web_server })\n{\n\t// create Redux store\n\tconst store = create_store({ development, create_routes, server: true, http_request: request, host: web_server.host, port: web_server.port })\n\n\t// internationalization\n\n\tlet locale\n\tlet messages\n\n\tif (localize)\n\t{\n\t\tconst result = localize(store, preferred_locale)\n\n\t\tlocale   = result.locale\n\t\tmessages = result.messages\n\t}\n\n\tconst entry_point = 'main' // may examine request.originalUrl to determine Webpack entry point\n\n\t// render the web page\n\treturn render\n\t({\n\t\tdisable_server_side_rendering,\n\t\turl: request.originalUrl.replace(/\\?$/, ''),\n\t\trender: (child_element, props) => \n\t\t{\n\t\t\tif (localize)\n\t\t\t{\n\t\t\t\tprops.locale   = locale\n\t\t\t\tprops.messages = messages\n\t\t\t}\n\n\t\t\treturn React.createElement(markup_wrapper, props, child_element)\n\t\t},\n\t\trender_html: element => <Html development={development} assets={assets()} entry_point={entry_point} locale={locale} head={head} body={body} style={style} store={store}>{element}</Html>,\n\t\tstore\n\t})\n\t.then(({ status, markup, redirect_to }) =>\n\t{\n\t\tif (redirect_to)\n\t\t{\n\t\t\treturn redirect(redirect_to)\n\t\t}\n\n\t\trespond({ status, markup })\n\t},\n\terror =>\n\t{\n\t\tlog.error(error)\n\n\t\tif (error.markup)\n\t\t{\n\t\t\trespond({ markup: error.markup, status: 500 })\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfail(error)\n\t\t}\n\t})\n}"]}