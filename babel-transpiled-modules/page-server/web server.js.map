{"version":3,"sources":["../../source/page-server/web server.js"],"names":[],"mappings":";;;;;;;qBAQwB,gBAAgB;;kBARvB,IAAI;;;;oBACJ,MAAM;;;;mBAEA,KAAK;;;;yBACL,YAAY;;;;sBAEhB,UAAU;;;;AAEd,SAAS,gBAAgB,CAAC,IAA6J,EACtM;kBAWW,MAAM,EAoBN,SAAS;KAhCuB,WAAW,GAAb,IAA6J,CAA3J,WAAW;KAAE,QAAQ,GAAvB,IAA6J,CAA9I,QAAQ;KAAE,MAAM,GAA/B,IAA6J,CAApI,MAAM;KAAE,IAAI,GAArC,IAA6J,CAA5H,IAAI;KAAE,IAAI,GAA3C,IAA6J,CAAtH,IAAI;KAAE,UAAU,GAAvD,IAA6J,CAAhH,UAAU;KAAE,GAAG,GAA5D,IAA6J,CAApG,GAAG;KAAE,6BAA6B,GAA3F,IAA6J,CAA/F,6BAA6B;KAAE,YAAY,GAAzG,IAA6J,CAAhE,YAAY;KAAE,aAAa,GAAxH,IAA6J,CAAlD,aAAa;KAAE,cAAc,GAAxI,IAA6J,CAAnC,cAAc;KAAE,IAAI,GAA9I,IAA6J,CAAnB,IAAI;KAAE,IAAI,GAApJ,IAA6J,CAAb,IAAI;KAAE,KAAK,GAA3J,IAA6J,CAAP,KAAK;;AAEnM,IAAG,GAAG,GAAG,IAAI,OAAO,CAAA;;AAEpB,KAAM,GAAG,GAAG,kBAAK,CAAA;;;;AAIjB,wBAAW,GAAG,EAAE,QAAQ,CAAC,CAAA;;;;AAIzB,UAAU,MAAM,CAAC,IAAI;;;;;;YAIb,IAAI;;;;;;;;;;;AAKV,QAAG,CAAC,KAAK,gBAAO,CAAA;;AAEhB,SAAI,CAAC,MAAM,GAAG,OAAO,eAAM,IAAI,KAAK,QAAQ,GAAG,eAAM,IAAI,GAAG,GAAG,CAAA;AAC/D,SAAI,CAAC,OAAO,GAAG,eAAM,OAAO,IAAI,gBAAgB,CAAA;;;;;;;EAEjD;;AAED,IAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;;;;AAIf,UAAU,SAAS;;;;;;;YAYZ,oBACL;AACA,iBAAW,EAAX,WAAW;;AAEX,cAAQ,EAAR,QAAQ;AACR,sBAAgB,EAAE,IAAI,CAAC,kBAAkB,EAAE,IAAI,IAAI,CAAC,mBAAmB,EAAE,IAAI,IAAI,CAAC,mBAAmB,EAAE;;AAEvG,YAAM,EAAN,MAAM;;AAEN,aAAO,EAAG,IAAI,CAAC,OAAO;AACtB,aAAO,EAAG,iBAAC,KAAkB,EAC7B;WADa,MAAM,GAAR,KAAkB,CAAhB,MAAM;WAAE,MAAM,GAAhB,KAAkB,CAAR,MAAM;;AAE1B,aAAK,IAAI,GAAG,MAAM,CAAA;;AAElB,WAAI,MAAM,EACV;AACC,cAAK,MAAM,GAAG,MAAM,CAAA;QACpB;OACD;AACD,UAAI,EAAO,cAAA,KAAK;cAAI,cAAU,CAAC,KAAK,CAAC;OAAA;AACrC,cAAQ,EAAG,kBAAA,EAAE;cAAI,MAAK,QAAQ,CAAC,EAAE,CAAC;OAAA;;AAElC,mCAA6B,EAA7B,6BAA6B;AAC7B,SAAG,EAAH,GAAG;;AAEH,kBAAY,EAAZ,YAAY;AACZ,mBAAa,EAAb,aAAa;;AAEb,oBAAc,EAAd,cAAc;;AAEd,UAAI,EAAJ,IAAI;AACJ,UAAI,EAAJ,IAAI;AACJ,WAAK,EAAL,KAAK;;AAEL,gBAAU,EAAV,UAAU;MACV,CAAC;;;;;;;EACF;;AAED,IAAG,CAAC,GAAG,CAAC,SAAS,CAAC,CAAA;;;AAGlB,IAAG,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,EAAE,UAAS,KAAK,EACrC;AACC,MAAI,KAAK,EACT;AACC,UAAO,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAA;GACvB;;AAED,KAAG,CAAC,IAAI,6CAA0C,IAAI,GAAG,IAAI,GAAG,WAAW,CAAA,SAAI,IAAI,CAAG,CAAA;EACtF,CAAC,CAAA;CACF","file":"web server.js","sourcesContent":["import fs   from 'fs'\nimport path from 'path'\n\nimport koa        from 'koa'\nimport koa_locale from 'koa-locale'\n\nimport render from './render'\n\nexport default function start_web_server({ development, localize, assets, host, port, web_server, log, disable_server_side_rendering, create_store, create_routes, markup_wrapper, head, body, style })\n{\n\tlog = log || console\n\n\tconst web = koa()\n\n\t// get locale from Http request\n\t// (the second parameter is the Http Get parameter name)\n\tkoa_locale(web, 'locale')\n\n\t// handle errors\n\n\tfunction* errors(next)\n\t{\n\t\ttry\n\t\t{\n\t\t\tyield next\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\t// log the error\n\t\t\tlog.error(error)\n\n\t\t\tthis.status = typeof error.code === 'number' ? error.code : 500\n\t\t\tthis.message = error.message || 'Internal error'\n\t\t}\n\t}\n\n\tweb.use(errors)\n\n\t// isomorphic rendering\n\n\tfunction* rendering()\n\t{\n\t\t// Material-UI asks for this,\n\t\t// but this isn't right,\n\t\t// because Node.js serves requests asynchronously\n\t\t// and therefore two different web browsers \n\t\t// may be asking for a rendered page simultaneously.\n\t\t//\n\t\t// global.navigator = { userAgent: request.headers['user-agent'] }\n\n\t\t// these parameters are for Koa app.\n\t\t// they can be modified to work with Express app if needed.\n\t\tyield render\n\t\t({\n\t\t\tdevelopment,\n\n\t\t\tlocalize,\n\t\t\tpreferred_locale: this.getLocaleFromQuery() || this.getLocaleFromCookie() || this.getLocaleFromHeader(),\n\n\t\t\tassets,\n\n\t\t\trequest : this.request, \n\t\t\trespond : ({ markup, status }) =>\n\t\t\t{\n\t\t\t\tthis.body = markup\n\n\t\t\t\tif (status)\n\t\t\t\t{\n\t\t\t\t\tthis.status = status\n\t\t\t\t}\n\t\t\t}, \n\t\t\tfail     : error => this.throw(error), \n\t\t\tredirect : to => this.redirect(to),\n\n\t\t\tdisable_server_side_rendering,\n\t\t\tlog,\n\n\t\t\tcreate_store,\n\t\t\tcreate_routes,\n\n\t\t\tmarkup_wrapper,\n\n\t\t\thead,\n\t\t\tbody,\n\t\t\tstyle,\n\n\t\t\tweb_server\n\t\t})\n\t}\n\n\tweb.use(rendering)\n\n\t// start http server\n\tweb.listen(port, host, function(error)\n\t{\n\t\tif (error)\n\t\t{\n\t\t\treturn log.error(error)\n\t\t}\n\n\t\tlog.info(`Webpage server is listening at http://${host ? host : 'localhost'}:${port}`)\n\t})\n}"]}